{# ATH Móvil Payment Modal #}
<div id="athm-modal" class="athm-modal" style="display: none;">
    <div class="athm-modal-overlay" onclick="closeATHMModal()"></div>
    <div class="athm-modal-content">
        <button type="button" class="athm-modal-close" onclick="closeATHMModal()">&times;</button>

        {# Step 1: Phone Number Entry #}
        <div id="athm-step-phone" class="athm-modal-step">
            <h2 class="athm-modal-title" data-en="Pay with ATH Móvil" data-es="Pagar con ATH Móvil"></h2>
            <p class="athm-modal-description" data-en="Enter your phone number to receive a notification" data-es="Ingresa tu número de teléfono para recibir una notificación"></p>

            <form id="athm-phone-form" onsubmit="submitPhoneNumber(event)">
                <div class="athm-form-group">
                    <label for="athm-phone-input" data-en="Phone Number" data-es="Número de Teléfono"></label>
                    <input
                        type="tel"
                        id="athm-phone-input"
                        name="phone_number"
                        class="athm-input"
                        placeholder="787-555-0100"
                        required
                        pattern="[0-9]{3}-?[0-9]{3}-?[0-9]{4}"
                    >
                    <small class="athm-help-text" data-en="Format: 787-555-0100" data-es="Formato: 787-555-0100"></small>
                </div>

                <div class="athm-amount-display">
                    <span data-en="Total:" data-es="Total:"></span>
                    <strong id="athm-total-display"></strong>
                </div>

                <button type="submit" class="athm-btn athm-btn-primary">
                    <span data-en="Send Payment Request" data-es="Enviar Solicitud de Pago"></span>
                </button>

                <div id="athm-error-message" class="athm-error" style="display: none;"></div>
            </form>
        </div>

        {# Step 2: Loading / Polling #}
        <div id="athm-step-loading" class="athm-modal-step" style="display: none;">
            <div class="athm-loader"></div>
            <h2 class="athm-modal-title" data-en="Waiting for confirmation..." data-es="Esperando confirmación..."></h2>
            <p class="athm-modal-description" data-en="Please confirm the payment in your ATH Móvil app" data-es="Por favor confirma el pago en tu aplicación de ATH Móvil"></p>

            <div class="athm-transaction-info">
                <p><strong data-en="Amount:" data-es="Monto:"></strong> <span id="athm-loading-total"></span></p>
                <p><strong data-en="Reference:" data-es="Referencia:"></strong> <span id="athm-loading-reference">-</span></p>
            </div>

            <button type="button" class="athm-btn athm-btn-secondary" onclick="closeATHMModal()">
                <span data-en="Cancel" data-es="Cancelar"></span>
            </button>
        </div>

        {# Step 3: Confirmation #}
        <div id="athm-step-success" class="athm-modal-step" style="display: none;">
            <div class="athm-success-icon">✓</div>
            <h2 class="athm-modal-title" data-en="Payment Successful!" data-es="¡Pago Exitoso!"></h2>
            <p class="athm-modal-description" data-en="Your payment has been processed" data-es="Tu pago ha sido procesado"></p>

            <div class="athm-transaction-info">
                <p><strong data-en="Amount:" data-es="Monto:"></strong> <span id="athm-success-total"></span></p>
                <p><strong data-en="Reference:" data-es="Referencia:"></strong> <span id="athm-success-reference"></span></p>
            </div>

            <button type="button" class="athm-btn athm-btn-primary" onclick="closeATHMModal()">
                <span data-en="Close" data-es="Cerrar"></span>
            </button>
        </div>

        {# Step 4: Error / Cancelled / Expired #}
        <div id="athm-step-error" class="athm-modal-step" style="display: none;">
            <div class="athm-error-icon">✕</div>
            <h2 class="athm-modal-title" id="athm-error-title"></h2>
            <p class="athm-modal-description" id="athm-error-description"></p>

            <button type="button" class="athm-btn athm-btn-secondary" onclick="closeATHMModal()">
                <span data-en="Close" data-es="Cerrar"></span>
            </button>
        </div>
    </div>
</div>
